# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License.
steps:
    - template: ./install-dependencies-steps.yaml

    - script: |
          yarn format:check
      displayName: check code formatting

    - script: |
          yarn copyright:check
      displayName: check for copyright headers

    - template: ./build-steps.yaml

    - script: |
          yarn lint:check
      displayName: run linter

    - template: ./test-steps.yaml
      parameters: { totalTestSlices: '${{ parameters.totalTestSlices }}', testSlicesToRun: '${{ parameters.testSlicesToRun }}' }

    - task: CopyFiles@2
      inputs:
          SourceFolder: packages
          Contents: |
              resource-deployment/dist/**/*
              !**/node_modules/**/*
              !**/.vscode/**/*
              !**/*.md
          TargetFolder: '$(Build.ArtifactStagingDirectory)'
      displayName: 'Copy files to staging directory'

    - task: PublishBuildArtifacts@1
      inputs:
          pathtoPublish: '$(Build.ArtifactStagingDirectory)'
          artifactName: drop
      displayName: 'Publish build artifacts'
